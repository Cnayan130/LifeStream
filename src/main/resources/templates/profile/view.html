<!DOCTYPE html>
<html lang="zh-CN"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<head>
    <!-- 标题会由 layout.html 自动组合 -->
    <title th:text="${user.username} + ' 的个人资料'">用户个人资料</title>
</head>

<body>

<!--
  ==================================================================
  [新增] 页面特定的 CSS 样式
  这些样式是专门为 view.html 准备的，使其融入你的 "紧凑卡片" 主题。
  ==================================================================
-->
<th:block layout:fragment="styles">
    <style>
        /* 个人资料头部 */
        .profile-header {
            display: flex;
            align-items: flex-start; /* 顶部对齐 */
            gap: 2rem; /* 头像和信息间的间距 */
            background-color: var(--surface-color);
            padding: 2rem;
            border-radius: var(--border-radius-lg); /* 使用大圆角 */
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
        }

        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%; /* 圆形头像 */
            object-fit: cover;
            border: 4px solid var(--surface-color);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .profile-info {
            flex: 1;
        }

        .profile-username {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .profile-meta {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .profile-bio {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        /* 统计数据 */
        .profile-stats {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* "编辑资料" 按钮 */
        .profile-actions .btn {
            padding: 0.6rem 1.2rem; /* 按钮稍大一些 */
        }

        /* 响应式布局：在小屏幕上垂直堆叠 */
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                align-items: center; /* 居中 */
                padding: 1.5rem;
                text-align: center;
            }
            .profile-stats {
                justify-content: center; /* 居中统计数据 */
            }
        }

        /* Tab 导航栏 */
        .nav-tabs {
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }
        .nav-tabs .nav-link {
            font-weight: 600;
            color: var(--text-muted);
            border: none;
            border-bottom: 3px solid transparent;
            padding: 0.75rem 1rem;
        }
        .nav-tabs .nav-link:hover {
            color: var(--primary-color);
        }
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            background-color: transparent;
            border-bottom-color: var(--primary-color);
        }

        /* 空状态 (无文章/相册) */
        .empty-content {
            text-align: center;
            padding: 4rem 2rem;
            background-color: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .empty-icon {
            font-size: 4rem;
            color: var(--primary-color);
            opacity: 0.3;
            margin-bottom: 1.5rem;
        }
        .empty-content h4 {
            font-weight: 600;
        }

        /* 文章卡片 (继承 .card，但添加特定样式) */
        .post-card .draft-indicator {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 0.25rem 0.6rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: var(--border-radius-sm);
            z-index: 10;
        }

        .post-card .post-img {
            height: 220px;
            object-fit: cover;
        }

        /* 相册卡片 */
        .album-card .album-cover {
            height: 200px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .album-card .album-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

    </style>
</th:block>


<!--
  ==================================================================
  [核心] 页面内容
  这是来自你原 view.html 的片段内容
  ==================================================================
-->
<div layout:fragment="content">

    <!--
      [重要] 我们使用 .container 而不是 .container-fluid
      来使个人主页内容在中间显示，这更符合阅读习惯。
    -->
    <div class="container py-4">

        <!-- Profile Header -->
        <div class="profile-header">
            <!-- 头像 -->
            <div class="profile-avatar-container">
                <img th:if="${user.avatarUrl}" th:src="${user.avatarUrl}"
                     class="profile-avatar" th:alt="${user.username} + '的头像'">
                <img th:unless="${user.avatarUrl}" th:src="@{/images/default-avatar.png}"
                     class="profile-avatar" alt="默认头像">
            </div>

            <!-- 信息 -->
            <div class="profile-info">
                <h1 class="profile-username" th:text="${user.username}">用户名</h1>
                <p class="profile-meta">
                    <i class="far fa-envelope me-1"></i>
                    <span th:text="${user.email}">用户邮箱</span>
                    <span class="ms-3">
                        <i class="far fa-calendar-alt me-1"></i>
                        加入于 <span th:text="${#temporals.format(user.createdAt, 'yyyy-MM-dd')}">2023-01-01</span>
                    </span>
                </p>

                <p th:if="${user.bio}" class="profile-bio" th:text="${user.bio}">用户简介</p>
                <p th:unless="${user.bio}" class="profile-bio text-muted">这个用户还没有填写个人简介</p>

                <!-- 统计 -->
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-value" th:text="${postCount}">0</span>
                        <span class="stat-label">文章</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" th:text="${albumCount}">0</span>
                        <span class="stat-label">相册</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" th:text="${imageCount}">0</span>
                        <span class="stat-label">图片</span>
                    </div>
                </div>

                <!-- 操作按钮 (仅自己可见) -->
                <div class="profile-actions" th:if="${isOwnProfile}">
                    <a th:href="@{/profile/settings}" class="btn btn-primary">
                        <i class="fas fa-edit me-1"></i>编辑资料
                    </a>
                </div>
            </div>
        </div>

        <!-- Content Tabs (文章 / 相册) -->
        <nav>
            <div class="nav nav-tabs" id="nav-tab" role="tablist">
                <button class="nav-link active" id="nav-posts-tab" data-bs-toggle="tab" data-bs-target="#nav-posts"
                        type="button" role="tab" aria-controls="nav-posts" aria-selected="true">
                    <i class="fas fa-file-alt me-1"></i>文章
                </button>
                <button class="nav-link" id="nav-albums-tab" data-bs-toggle="tab" data-bs-target="#nav-albums"
                        type="button" role="tab" aria-controls="nav-albums" aria-selected="false">
                    <i class="fas fa-images me-1"></i>相册
                </button>
            </div>
        </nav>

        <div class="tab-content" id="nav-tabContent">

            <!-- 文章 Tab -->
            <div class="tab-pane fade show active" id="nav-posts" role="tabpanel" aria-labelledby="nav-posts-tab">

                <!-- 空状态 -->
                <div th:if="${#lists.isEmpty(posts.content)}" class="empty-content mt-4">
                    <div class="empty-icon"><i class="far fa-file-alt"></i></div>
                    <h4>暂无文章</h4>
                    <p class="text-muted" th:if="${isOwnProfile}">您还没有发布任何文章。</p>
                    <p class="text-muted" th:unless="${isOwnProfile}">该用户还没有发布任何文章。</p>
                    <a th:if="${isOwnProfile}" th:href="@{/posts/new}" class="btn btn-primary mt-3">
                        <i class="fas fa-pen me-1"></i>写文章
                    </a>
                </div>

                <!-- 文章列表 -->
                <div th:unless="${#lists.isEmpty(posts.content)}" class="posts-container mt-4">
                    <!-- 你的 .card 样式会在这里生效 -->
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                        <div class="col" th:each="post : ${posts.content}">
                            <div class="card post-card h-100 position-relative">
                                <!-- 草稿提示 -->
                                <div th:if="${isOwnProfile && !post.published}" class="draft-indicator">
                                    <i class="fas fa-save me-1"></i>草稿
                                </div>

                                <img th:if="${post.coverImage}" th:src="${post.coverImage}"
                                     class="card-img-top post-img" th:alt="${post.title}">
                                <img th:unless="${post.coverImage}" th:src="@{/images/default-post.jpg}"
                                     class="card-img-top post-img" alt="默认封面">

                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">
                                        <a th:href="@{'/posts/' + ${post.id}}" class="text-decoration-none" th:text="${post.title}">文章标题</a>
                                    </h5>
                                    <p class="card-text text-muted" th:text="${post.summary ?: (post.content != null ? #strings.abbreviate(#strings.unescapeJava(#strings.replace(#strings.replace(post.content, '<[^>]*>', ''), '&[^;]+;', ' ')), 100) : '无摘要')}">文章摘要</p>

                                    <div class="mt-auto">
                                        <small class="text-muted">
                                            <i class="far fa-calendar-alt me-1"></i>
                                            <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd')}">日期</span>
                                        </small>
                                        <!-- [待办] 在这里添加标签等... -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 分页 -->
                    <nav th:if="${totalPages > 1}" aria-label="Page navigation" class="mt-4">
                        <ul class="pagination justify-content-center">
                            <!-- 你的分页样式会在这里生效 -->
                            <li th:class="${currentPage == 0} ? 'page-item disabled' : 'page-item'">
                                <a class="page-link" th:href="${currentPage == 0} ? '#' : @{'/profile/' + ${user.username}(page=${currentPage - 1})}">&laquo;</a>
                            </li>
                            <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                th:class="${i == currentPage} ? 'page-item active' : 'page-item'">
                                <a class="page-link" th:href="@{'/profile/' + ${user.username}(page=${i})}" th:text="${i + 1}">1</a>
                            </li>
                            <li th:class="${currentPage == totalPages - 1} ? 'page-item disabled' : 'page-item'">
                                <a class="page-link" th:href="${currentPage == totalPages - 1} ? '#' : @{'/profile/' + ${user.username}(page=${currentPage + 1})}">&raquo;</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- 相册 Tab -->
            <div class="tab-pane fade" id="nav-albums" role="tabpanel" aria-labelledby="nav-albums-tab">

                <!-- 空状态 -->
                <div th:if="${#lists.isEmpty(albums)}" class="empty-content mt-4">
                    <div class="empty-icon"><i class="far fa-images"></i></div>
                    <h4>暂无相册</h4>
                    <p class="text-muted" th:if="${isOwnProfile}">您还没有创建任何相册。</p>
                    <p class="text-muted" th:unless="${isOwnProfile}">该用户还没有创建任何相册。</p>
                    <a th:if="${isOwnProfile}" th:href="@{/albums/new}" class="btn btn-primary mt-3">
                        <i class="fas fa-plus me-1"></i>创建相册
                    </a>
                </div>

                <!-- 相册列表 -->
                <div th:unless="${#lists.isEmpty(albums)}" class="albums-container mt-4">
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">
                        <div class="col" th:each="album : ${albums}">
                            <div class="card album-card h-100">
                                <div class="album-cover">
                                    <img th:if="${album.coverImageUrl}" th:src="${album.coverImageUrl}" alt="相册封面">
                                    <!-- [待办] 你的原代码是 /api/albums/.../cover，请确保 coverImageUrl 是正确的 -->

                                    <div th:unless="${album.coverImageUrl}" class="d-flex align-items-center justify-content-center w-100 h-100">
                                        <i class="fas fa-images fa-3x text-muted"></i>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <a th:href="@{'/albums/' + ${album.id}}" class="text-decoration-none" th:text="${album.name}">相册名称</a>
                                    </h5>
                                    <p class="card-text text-truncate text-muted" th:text="${album.description ?: '暂无描述'}">相册描述...</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 查看全部按钮 -->
                    <div class="text-center mt-4" th:if="${albumCount > 4}">
                        <a th:href="@{'/albums/user/' + ${user.username}}" class="btn btn-outline-primary">
                            查看全部相册
                        </a>
                    </div>
                </div>
            </div>

        </div> <!-- 结束 .tab-content -->
    </div> <!-- 结束 .container -->
</div> <!-- 结束 layout:fragment="content" -->

</body>
</html>